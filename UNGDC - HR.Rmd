---
title: "UNGDC"
author: "JGUP"
date: "10/10/2019"
output: html_document
---

```{r setup, include=FALSE}
library(compareDF)
library(dplyr)
library(foreign)
library(ggplot2)
library(haven)
library(lmtest)
library(pander)
library(plm)
library(quanteda)
library(readtext)
library(readxl)
library(RColorBrewer)
library(rworldmap)
library(stargazer)
library(stringr)
library(syuzhet)
library(texreg)
library(tidyr)
library(zip)
library(tibble)
#install.packages("tidytext")
#install.packages("tidyverse")
library(tidytext)
library(tidyverse)
library(glue)
library(remotes)
install_github("EmilHvitfeldt/textdata")
install_github("juliasilge/tidytext")
```

### PTS and UNGDC data

```{r}
#filelist <- list.files(path = root_folder, pattern = '*.txt', recursive = TRUE)
#filenames <- basename(filelist)
#ungdc_files <- data.frame(t(sapply(strsplit(filenames, '_'), 
#                 function(x) c(x[1], x[2], substr(x[3], 1, 4)))))
#colnames(ungdc_files) <- c('country', 'number', 'year')
#ungdc_files$text <- sapply(paste0(root_folder, filelist), function(x) readChar(x, file.info(x)$size))
#load(url("http://www.politicalterrorscale.org/Data/Files/PTS-2019.RData"))
```

# tadaproject
Human Rights in the UNGA

Using the code of the  The Lancet Countdown report: Nick Watts et al. (2018). "The 2018 report of the Lancet Countdown on health and climate change: shaping the health of nations for centuries to come." The Lancet, 392(10163): 2479-2514. With the UNGA Corpus.

#Data

#Loading data from the UNGDC data

### UNGDC data
```{r}
#Upload UNGDC data
dir.create(temp <- tempfile())
urlungdc<-'https://dataverse.harvard.edu/api/access/datafile/:persistentId?persistentId=doi:10.7910/DVN/0TJX8Y/PZUURT'

download.file(urlungdc, paste0(temp, '/PZUURT.zip'), mode="wb",
              exdir = temp)

unzip(paste0(temp, '/PZUURT.zip'), exdir = temp)

ungd_files <- readtext(paste0(temp, "/Converted sessions/*"),
                       docvarsfrom = "filenames", 
                       dvsep="_", 
                       docvarnames = c("Country", "Session", "Year"))

ungd_files$doc_id <- str_replace(ungd_files$doc_id , ".txt", "") %>%
   str_replace(. , "_\\d{2}", "")

unlink(temp)
rm(temp)
rm(urlungdc)
```


### PTS data
```{r}
load(url("http://www.politicalterrorscale.org/Data/Files/PTS-2019.RData"))
PTS_2019<-arrange(PTS_2019,Country,Year)

PTS_2019<-PTS_2019 %>% 
  group_by(Country) %>% 
  mutate(.,PTS_S_ch=c(NA,diff(PTS_S)))

PTS_2019<-mutate(PTS_2019,PTS_S_var= ifelse(PTS_S_ch>0,1,0))

PTS_2019<-PTS_2019 %>% 
  group_by(Country) %>% 
  mutate(.,PTS_H_ch=c(NA,diff(PTS_H)))

PTS_2019<-mutate(PTS_2019,PTS_H_var= ifelse(PTS_H_ch>0,1,0))

PTS_2019<-PTS_2019 %>% 
  group_by(Country) %>% 
  mutate(.,PTS_A_ch=c(NA,diff(PTS_A)))

PTS_2019<-mutate(PTS_2019,PTS_A_var= ifelse(PTS_A_ch>0,1,0))
```


### Merging the datasets UNGD and PTS

```{r}
#compare years
PTS_2019 %>%
      group_by(Year) %>%
      summarise(n = n())

ungd_files %>%
      group_by(Year) %>%
      summarise(n = n())
```

```{r}
#compare country
colnames(ungd_files)[colnames(ungd_files)=="Country"] <- "MergeCountry"
colnames(PTS_2019)[colnames(PTS_2019)=="WordBank_Code_A"] <- "MergeCountry"

PTS_2019 %>%
      group_by(MergeCountry) %>%
      summarise(n = n())

ungd_files %>%
      group_by(MergeCountry) %>%
      summarise(n = n())

merge_PTS_ungd <- merge(PTS_2019, ungd_files, by = c('Year','MergeCountry'), all=TRUE)

merge_PTS_ungd1976 <- subset(merge_PTS_ungd, !merge_PTS_ungd$Year<1976)

NA_PTS_ungd1976 <- subset(merge_PTS_ungd1976, is.na(merge_PTS_ungd1976$MergeCountry))

mergeNA_PTS_ungd_1976 <- subset(merge_PTS_ungd1976, !is.na(merge_PTS_ungd1976$MergeCountry))

tail(mergeNA_PTS_ungd_1976)
head(NA_PTS_ungd1976,20)
tail(NA_PTS_ungd1976)
#there are 11 countries which we have to delete due to non-existing data in the text corpus
```

```{r}
#Deleting NAs in the text - speeches rows from the "mergeNA_PTS_ungd_1976"
clean_PTS_ungd1976 <- subset(mergeNA_PTS_ungd_1976, !is.na(mergeNA_PTS_ungd_1976$text))
head(clean_PTS_ungd1976)
tail(clean_PTS_ungd1976)
```

##Creating corpus object: clean ungd merged corpus for regression analysis
```{r}
clean_ungd_corpus <- corpus(clean_PTS_ungd1976, text_field = "text") 
# ungdc.1990 <- corpus_subset(ungd_corpus, Year>1990)
```

#Pre-processing

Tokenizing corpus.

```{r}
#Tokenization and basic pre-processing
clean_toks_UNGD <- tokens(clean_ungd_corpus, what = "word",
              remove_punct = TRUE,
              remove_symbols = TRUE,
              remove_numbers = TRUE,
              remove_twitter = TRUE,
              remove_url = TRUE,
              remove_hyphens = FALSE,
              verbose = TRUE, 
              include_docvars = TRUE)
```

```{r}
lower_UNGD <- tokens_tolower(clean_toks_UNGD)

stop_UNGD <- tokens_select(lower_UNGD, stopwords("english"), selection = "remove", padding = FALSE)

ngram_UNGD <- tokens(stop_UNGD, ngrams = c(1:2), include_docvars = TRUE)
```

##################################################################
#Dictionary Analysis HR binary
## 1. Identifying the frequency of usage of "Human Rights" in UN Speeches

Creating compound tokens from the "Human Rights" concept:

```{r}
listHHRR <- list( c("Human", "Rights")) 
```

```{r}
compound_UNGD_HHRR <- tokens_compound(lower_UNGD, listHHRR, valuetype = "fixed", concatenator = "_")
```

Creating a Dictionary of Human Rights, in order to identify the frequency of the concept in UNGD Speeches:

```{r}
HHRR_dict <- dictionary(list(Human.Rights=c("Human Rights")))
```

## Look up Human Rights term counts

Looking up and counting the frequency of usage of "Human Rights" in the UN GA speeches.

--> Apply a dictionary (HHRR) to a dfm by looking up all dfm features for matches in a a set of dictionary values.

```{r}
dfm_UNGD_HHRR <- dfm(compound_UNGD_HHRR)
HHRR_dfm <- dfm_lookup(dfm_UNGD_HHRR, HHRR_dict, valuetype = "fixed")
```

Data Frame of human rights variables in UNGDC

```{r}
#creating a data frame 
Human.Rights_HHRR <- convert(HHRR_dfm, to = "data.frame")

#converting documentID into two columns - country and year
HHRR_counts <- Human.Rights_HHRR %>%
  separate(document, c("country", "year"), "_")

#year as numeric
HHRR_counts$year <- as.numeric(HHRR_counts$year)
HHRR_counts <- plyr::rename(HHRR_counts, c("Human.Rights"="HHRR"))
```


```{r}
#Merge HHRR counts with the MergeNA_PTS_ungd_1976 data set

colnames(HHRR_counts)[colnames(HHRR_counts)=="country"] <- "MergeCountry"
colnames(HHRR_counts)[colnames(HHRR_counts)=="year"] <- "Year"

colnames(clean_PTS_ungd1976)[colnames(clean_PTS_ungd1976)=="MergeCountry"] <- "MergeCountry"

clean_PTS_ungd1976 %>%
      group_by(MergeCountry) %>%
      summarise(n = n())

HHRR_counts %>%
      group_by(MergeCountry) %>%
      summarise(n = n())

merge_HHRRcounts <- merge(clean_PTS_ungd1976, HHRR_counts, by = c('MergeCountry','Year'), all=TRUE)
```


#Baseline

## Model 1. Relation between changes in PTS and mentions of the "Human Rights" concept in UNGD speeches

Linear regression model between changes in PTS (State Department) and mentions of the "Human Rights" concept in UNGD speeches (1976 - 2018)

```{r}
ModelHHRR_S <- lm (HHRR ~ PTS_S + PTS_S_ch + PTS_S*PTS_S_ch, data = merge_HHRRcounts)
screenreg(ModelHHRR_S)
#PTS_S significant and negative

ModelHHRR_A <- lm (HHRR ~ PTS_A + PTS_A_ch + PTS_A*PTS_A_ch, data = merge_HHRRcounts)
screenreg(ModelHHRR_A)
#PTS_A significant and negative

ModelHHRR_H <- lm (HHRR ~ PTS_H + PTS_H_ch + PTS_H*PTS_H_ch, data = merge_HHRRcounts)
screenreg(ModelHHRR_H)
#PTS_H insignificant
```



###Model Regressoin with sophisticated human rights dictionary
### Create Human Rights Dictionary

```{r}
#create human rights lists from the three sources

HRlistFariss <- list( c("kill"), c("forc"), c("arm"), c("group"), c("civilian"), c("human"), c("secur"), c("disappear"), c("attack"), c("execut") , c("tortur"), c("member"), c("includ"), c("arrest"), c("prison"), c("polit"), c("amnesti"), c("trial"), c("releas"), c("imprison"), c("sentenc"), c("charg"), c("conscience"), c("polic"), c("offic"), c("illtreat"), c("death"), c("court"), c("alleg"), c("law"), c("service"), c("concern"), c("appeal"), c("servic"), c("committee"),    c("militari"), c("area"), c("continu"), c("section"), c("state"), c("dure"), c("arrest"), c("accord"), c("offici"), c("presid"), c("opposit"), c("howev"), c("parti"), c("author"), c("law"), c("provid"), c("gener"), c("public"), c("constitut"), c("employ"), c("women"), c("right"), c("respect"), c("freedom"), c("prohibit"), c("case"), c("ngo"), c("tortur"), c("gener"), c("labor"), c("detain"), c("releas"), c("elect"), c("local"), c("presidenti"), c("region"), c("mani"), c("regim"), c("nation"), c("ethnic"), c("union"), c("practic"), c("work"), c("foreign"), c("children"), c("investig"), c("relig"), c("islam"), c("roma"), c("worker"), c("traffic"), c("feder"), c("parliament"))

HRlistGreene <- list(c("committed"), c("victims"), c("populations"), c("scale"), c("armed"), c("army"), c("commanders"), c("conscripted"), c("assassinations"), c("massacres"), c("internally", "displaced"), c("food"), c("humanitarian"), c("landmines"), c("money"), c("raped"), c("disappearances"), c("frequently"), c("numerous"), c("widespread"), c("common"), c("regularly"), c("routinely"), c("systematic"), c("extensive"))

HRlistWatanabe <- list(c("human", "rights"), c("violat"), c("race"), c("dignit"), c("protect"), c("citizen"), c("educat"), c("child"), c("refugee"), c("communit"), c("people"), c("responsibl"), c("health"), c("world"))

HRlist <- do.call(c, list(HRlistFariss, HRlistGreene, HRlistWatanabe))
#summary(HRlist)

```

Creating compound tokens from the "Human Rights" concept:

```{r}
compound_UNGD_HRlist <- tokens_compound(lower_UNGD, HRlist, valuetype = "fixed", concatenator = "_")
#compound_UNGD_HRlist
```

#create dictionaries from the three sources

```{r}
dict_HRFariss <- dictionary(list(human_rightsF = c("kill", "forc", "arm", "group", "civilian", "human", "secur", "disappear", "attack", "execut" , "tortur", "member", "includ", "arrest", "prison", "polit", "amnesti", "trial", "releas", "imprison", "sentenc", "charg", "conscience", "polic", "offic", "illtreat", "death", "court", "alleg", "law", "service", "concern", "appeal", "servic", "committee", "militari", "area", "continu", "section", "state", "dure", "arrest", "offici", "presid", "opposit", "parti", "author", "law", "provid", "gener", "public", "constitut", "employ", "women", "right", "respect", "freedom", "prohibit", "case", "ngo", "tortur", "gener", "labor", "detain", "releas", "elect", "local", "presidenti", "region", "mani", "regim", "nation", "ethnic", "union", "practic", "work", "foreign", "children", "investig", "relig", "islam", "roma", "worker", "traffic", "feder", "parliament")))

dict_HRGreene <- dictionary(list(human_rightsG = c("commit", "victim", "popul", "scale", "armi", "command", "conscript", "assassin", "massacr", "intern_displac", "food", "humanitarian", "landmin", "money", "rape", "disappear", "widespread", "systemat", "extens")))

#checking the stemmed version of dict_HRGreene
char_HRGreene <- as.character(dict_HRGreene)
toks_HRGreene <- tokens(char_HRGreene)
toks_HRGreene
remove_HRGreene <- tokens(toks_HRGreene, remove_punct = TRUE)
remove_HRGreene
tokens_wordstem(remove_HRGreene)

dict_HRWatanabe <- dictionary(list(human_rightsW = c("human_rights", "violat", "race", "dignit", "protect", "citizen", "educat", "child", "refugee", "communit", "people", "responsibl", "health", "world")))

#combine the dictionaries
HRdict <- c(dict_HRGreene["human_rightsG"], dict_HRFariss["human_rightsF"], dict_HRWatanabe["human_rightsW"])

#one complete dictionary
HRdict_total <- dictionary(list(human_rights_total = c("kill", "forc", "arm", "group", "civilian", "human", "secur", "disappear", "attack", "execut" , "tortur", "member", "includ", "arrest", "prison", "polit", "amnesti", "trial", "releas", "imprison", "sentenc", "charg", "conscience", "polic", "offic", "illtreat", "death", "court", "alleg", "law", "service", "concern", "appeal", "servic", "committee", "militari", "area", "continu", "section", "state", "dure", "arrest", "offici", "presid", "opposit", "parti", "author", "law", "provid", "gener", "public", "constitut", "employ", "women", "right", "respect", "freedom", "prohibit", "case", "ngo", "tortur", "gener", "labor", "detain", "releas", "elect", "local", "presidenti", "region", "mani", "regim", "nation", "ethnic", "union", "practic", "work", "foreign", "children", "investig", "relig", "islam", "roma", "worker", "traffic", "feder", "parliament", "commit", "victim", "popul", "scale", "armi", "command", "conscript", "assassin", "massacr", "intern_displac", "food", "humanitarian", "landmin", "money", "rape", "disappear", "widespread", "systemat", "extens", "human_rights", "violat", "race", "dignit", "protect", "citizen", "educat", "child", "refugee", "communit", "people", "responsibl", "health", "world")))
```

#Dictionary Analysis HR binary
## 1. Identifying the frequency of usage of "Human Rights" in UN Speeches

```{r}
HRdict
HRdict_total
```

## Look up Human Rights dictionary counts

Looking up and counting the frequency of usage of "Human Rights" in the UN GA speeches.

--> Apply a dictionary (HHRR) to a dfm by looking up all dfm features for matches in a a set of dictionary values.

```{r}
dfm_UNGD_HR <- dfm(compound_UNGD_HRlist)
#combined dict
HR_dfm <- dfm_lookup(dfm_UNGD_HR, HRdict, valuetype = "fixed")
#total dict
HR_dfm_total <- dfm_lookup(dfm_UNGD_HR, HRdict_total, valuetype = "fixed")
```

Data Frame of human rights variables in UNGDC

```{r}
#creating a data frame 
Human.Rights_HR <- convert(HR_dfm_total, to = "data.frame")

#converting documentID into two columns - country and year
HR_counts <- Human.Rights_HR %>%
  separate(document, c("country", "year"), "_")

#year as numeric
HR_counts$year <- as.numeric(HR_counts$year)
HR_counts <- plyr::rename(HR_counts, c("human_rights_total"="HR"))
```

```{r}
#Merge total HR dictionary counts with the MergeNA_PTS_ungd_1976 data set

colnames(HR_counts)[colnames(HR_counts)=="country"] <- "MergeCountry"
colnames(HR_counts)[colnames(HR_counts)=="year"] <- "Year"

colnames(merge_HHRRcounts)[colnames(merge_HHRRcounts)=="MergeCountry"] <- "MergeCountry"

merge_HHRRcounts %>%
      group_by(MergeCountry) %>%
      summarise(n = n())

HR_counts %>%
      group_by(MergeCountry) %>%
      summarise(n = n())

merge_HRdict_counts <- merge(merge_HHRRcounts, HR_counts, by = c('MergeCountry','Year'), all=TRUE)

head(merge_HRdict_counts)
#merged dataset with both dictionaries: HHRRterm and HRdict
```


#Sophisticated Human Rights Dictionary Model

## Model 2. Relation between changes in PTS and mentions of the features within the human rights dictionary in UNGD speeches

Linear regression model between changes in PTS (State Department) and mentions of the "Human Rights" concept in UNGD speeches (1976 - 2018)

```{r}
ModelHRdict_S <- lm (HR ~ PTS_S + PTS_S_ch + PTS_S*PTS_S_ch, data = merge_HRdict_counts)
screenreg(ModelHRdict_S)

ModelHRdict_A <- lm (HR ~ PTS_A + PTS_A_ch + PTS_A*PTS_A_ch, data = merge_HRdict_counts)
screenreg(ModelHRdict_A)

ModelHRdict_H <- lm (HR ~ PTS_H + PTS_H_ch + PTS_H*PTS_H_ch, data = merge_HRdict_counts)
screenreg(ModelHRdict_H)
```

################################################################
###Hypothesis 2: sentiment dictionary analysis

```{r}
#get sentiment analysis with four different dictionaries: syuzhet (1), afinn, bing, and nrc

#tokenise with tidytext

sent_words <- clean_PTS_ungd1976 %>%
  group_by(MergeCountry) %>%
  ungroup() %>%
  unnest_tokens(word, text)

sent_words_lim <- subset(sent_words, select = c(Year, MergeCountry, PTS_A, PTS_A_var, Session, word))
sent_words_lim

#find total number of words
wordstotal <- sent_words_lim %>%
  count(MergeCountry)
wordstotal$total<-wordstotal$n
wordstotal<-wordstotal[,c("MergeCountry", "total")]
wordstotal

```
### Add sentiment dictionaries and dictionary counts

```{r}
#negative sentiment - bing
sentiment_plotn <-
  sent_words_lim %>%
  inner_join(get_sentiments("bing")) %>% 
  filter(sentiment == "negative") %>%
  count(Year, MergeCountry, sentiment)

library(ggplot2)

ggplot(sentiment_plotn, aes(x=Year, y=n))+
  geom_smooth(color="blue")+
  geom_point(color="red")
  theme_minimal()+
  ylab("Frequency of Negative Words in UN speeches")+
  xlab("Year")

#positive emotions UN speeches - bing

sentiment_plotp <-
  sent_words_lim %>%
  inner_join(get_sentiments("bing")) %>% 
  filter(sentiment == "positive") %>%
  count(Year, MergeCountry, sentiment)

ggplot(sentiment_plotp, aes(x=as.numeric(Year), y=n))+
  geom_smooth(color="red")+
  geom_point(color="blue")+
  theme_minimal()+
  ylab("Frequency of Positive Words in UN speeches")+
  xlab("Year")

###no sentiment filter - bing
count_UNGDsentiment_bing <-
  sent_words_lim %>%
  inner_join(get_sentiments("bing")) %>% 
  count(Year, MergeCountry, sentiment)

count_UNGDsentiment_bing


##afinn
count_UNGDsentiment_afinn <- sent_words_lim %>% 
  inner_join(get_sentiments("afinn")) %>%
  group_by(MergeCountry, Year) %>%
  count (Year, MergeCountry, value) %>%
  mutate(method = "AFINN") 

count_UNGDsentiment_afinn

#count sentiment dictionary nrc
count_UNGDsentiment_nrc <- sent_words_lim %>%
  inner_join(get_sentiments("nrc")) %>%
  group_by(MergeCountry, Year) %>%
  count (Year, MergeCountry, sentiment) %>%
  mutate(method = "nrc")

count_UNGDsentiment_nrc

```

#play with subsets

```{r}
##bing
bing <- sent_words_lim %>% 
  filter(MergeCountry == "USA") %>%
  inner_join(get_sentiments("bing")) %>% 
  group_by(MergeCountry) %>% 
  mutate(method = "BING")
bing

##nrc
nrc_anger <- get_sentiments("nrc") %>% 
  filter(sentiment == "anger")

sent_words_lim %>%
  filter(MergeCountry == "USA") %>%
  inner_join(nrc_anger) %>%
  count(word, sort = TRUE)

```

```{r}
#Merge sentiment dictionaries with the MergeNA_PTS_ungd_1976 data set

head(merge_HRdict_counts)
#merged dataset with both dictionaries: HHRRterm and HRdict

colnames(count_UNGDsentiment_bing)[colnames(count_UNGDsentiment_bing)=="sentiment"] <- "sentiment_bing"
colnames(count_UNGDsentiment_bing)[colnames(count_UNGDsentiment_bing)=="n"] <- "n_bing"

head(count_UNGDsentiment_afinn)
head(count_UNGDsentiment_bing)
head(count_UNGDsentiment_nrc)
#merging variables are names the same

merge_sentiment_counts1 <- merge(merge_HRdict_counts, count_UNGDsentiment_bing, by = c('MergeCountry','Year'), all=TRUE)
head(merge_sentiment_counts1)

```





```{r}
#create dfm with clean tokenized text
clean_dfm_UNGD <- dfm(clean_toks_UNGD) 
tbl_UNGD <- convert(clean_dfm_UNGD, to = "data.frame")

#dict_bing <- get_sentiment_dictionary(dictionary = "bing")
#dict_syuzhet <- get_sentiment_dictionary(dictionary = "syuzhet")
#dict_afinn <- get_sentiment_dictionary(dictionary = "afinn")
#dict_nrc <- get_sentiment_dictionary(dictionary = "nrc", lang = "english")
#data_dictionary_AFINN
#sent_bing <- get_sentiment(clean_toks_UNGD[1], method = "bing", lexicon = dict_bing)


plot(
  sent_syuzhet, 
  type="h", 
  main="Example Plot of Speech", 
  xlab = "Speech Time", 
  ylab= "Emotional Valence"
  )

#table of categories in emotions
pander::pandoc.table(cat_nrc[1:10, 1:8], split.table = Inf)

#table of negative vs positive
pander::pandoc.table(cat_nrc[1:10, 9:10], split.table = Inf)

#graph of categories in emotions in percentages graph shows what kind of emotions they use in the first speech
barplot(
  sort(colSums(prop.table(cat_nrc[, 1:8]))), 
  horiz = TRUE, 
  cex.names = 0.7, 
  las = 1, 
  main = "Emotions in UN speech", xlab="Percentage"
  )
```


Data Frame of human rights variables in UNGDC

```{r}
#creating a data frame 
Human.Rights_HR <- convert(HR_dfm_total, to = "data.frame")

#converting documentID into two columns - country and year
HR_counts <- Human.Rights_HR %>%
  separate(document, c("country", "year"), "_")

#year as numeric
HR_counts$year <- as.numeric(HR_counts$year)
HR_counts <- plyr::rename(HR_counts, c("human_rights_total"="HR"))
```


```{r}
#Merge total HR dictionary counts with the MergeNA_PTS_ungd_1976 data set

colnames(HR_counts)[colnames(HR_counts)=="country"] <- "MergeCountry"
colnames(HR_counts)[colnames(HR_counts)=="year"] <- "Year"

colnames(merge_HHRRcounts)[colnames(merge_HHRRcounts)=="MergeCountry"] <- "MergeCountry"

merge_HHRRcounts %>%
      group_by(MergeCountry) %>%
      summarise(n = n())

HR_counts %>%
      group_by(MergeCountry) %>%
      summarise(n = n())

merge_HRdict_counts <- merge(merge_HHRRcounts, HR_counts, by = c('MergeCountry','Year'), all=TRUE)

head(merge_HRdict_counts)
#merged dataset with both dictionaries: HHRRterm and HRdict
```


#Sentiment Analysis Regression

## Model 1. Relation between changes in PTS and sentiment of features within the bing (binary) sentiment dictionary in UNGD speeches

Linear regression model between changes in PTS (State Department) and mentions of the "Human Rights" concept in UNGD speeches (1976 - 2018)

```{r}
Modelbing_S <- lm (HR ~ PTS_S + PTS_S_ch + PTS_S*PTS_S_ch, data = merge_HRdict_counts)
screenreg(Modelbing_S)

Modelbing_A <- lm (HR ~ PTS_A + PTS_A_ch + PTS_A*PTS_A_ch, data = merge_HRdict_counts)
screenreg(Modelbing_A)

Modelbing_H <- lm (HR ~ PTS_H + PTS_H_ch + PTS_H*PTS_H_ch, data = merge_HRdict_counts)
screenreg(Modelbing_H)
```

#Sentiment Analysis Regression

## Model 1 (baseline). Relation between changes in PTS and sentiment of features within the bing (binary) sentiment dictionary in UNGD speeches

Linear regression model between changes in PTS (State Department) and mentions of the "Human Rights" concept in UNGD speeches (1976 - 2018)

```{r}
ModelHRdict_S <- lm (HR ~ PTS_S + PTS_S_ch + PTS_S*PTS_S_ch, data = merge_HRdict_counts)
screenreg(ModelHRdict_S)

ModelHRdict_A <- lm (HR ~ PTS_A + PTS_A_ch + PTS_A*PTS_A_ch, data = merge_HRdict_counts)
screenreg(ModelHRdict_A)

ModelHRdict_H <- lm (HR ~ PTS_H + PTS_H_ch + PTS_H*PTS_H_ch, data = merge_HRdict_counts)
screenreg(ModelHRdict_H)
```

## Model 2(all sentiment dictionaries). Relation between changes in PTS and sentiment of features within the bing (binary) sentiment dictionary in UNGD speeches

```{r}

regression
reg HHRR changeinPTS PTS_year PTS_year * changeinPTS, 
reg HHRR changeinPTS PTS_year PTS_year * changeinPTS, clustered errors
reg HHRR changeinPTS PTS_year PTS_year * changeinPTS, time-fixed effects, country-fixed effects, clustered errors
```



```{r}
#HHRR
merge_HRdict_counts1<-merge_HRdict_counts %>% 
                      subset(!is.na(Region)) %>% 
                      group_by(Region,Year) %>%
                      summarise_at("HHRR",funs(mean(., na.rm=TRUE)))
merge_HRdict_counts1$Region<-factor(merge_HRdict_counts1$Region, labels=c("East Asia and Pacific","Europe and Central Asia", "Latin America and Caribbean", "Middle East and North Africa","North America","South Asia","Sub-Saharan Africa" ),levels=c("eap","eca","lac","mena","na","sa","ssa"))

levels(merge_HRdict_counts1$Region)

ggplot(merge_HRdict_counts1,aes(x=Year,y=HHRR, color=Region))+
  geom_line()



#HR
merge_HRdict_counts2<-merge_HRdict_counts %>% 
                      subset(!is.na(Region)) %>% 
                      group_by(Region,Year) %>%
                      summarise_at("HR",funs(mean(., na.rm=TRUE)))
merge_HRdict_counts2$Region<-factor(merge_HRdict_counts2$Region, labels=c("East Asia and Pacific","Europe and Central Asia", "Latin America and Caribbean", "Middle East and North Africa","North America","South Asia","Sub-Saharan Africa" ),levels=c("eap","eca","lac","mena","na","sa","ssa"))
ggplot(merge_HRdict_counts2,aes(x=Year,y=HR, color=Region))+
  geom_line()


#hhrr pts 1-3
merge_HRdict_counts3<-merge_HRdict_counts %>% 
                      subset(PTS_A<4) %>% 
                      group_by(Region,Year) %>%
                      summarise_at("HHRR",funs(mean(., na.rm=TRUE)))
merge_HRdict_counts3$Region<-factor(merge_HRdict_counts3$Region, labels=c("East Asia and Pacific","Europe and Central Asia", "Latin America and Caribbean", "Middle East and North Africa","North America","South Asia","Sub-Saharan Africa" ),levels=c("eap","eca","lac","mena","na","sa","ssa"))

g_merge_HRdict_counts3<-ggplot(merge_HRdict_counts3,aes(x=Year,y=HHRR,color=Region))+
geom_line()+
  scale_y_continuous(limits = c(0, 20), breaks=seq(0,20,5),expand = c(0, 0))+
  scale_x_continuous(limits = c(1976, 2018), breaks=seq(1976,2018,7),expand = c(0, 0))+
labs(title="Average count of words related to Human Rights in UN speeches", 
       subtitle="Countries with PTS score of 1 to 3 grouped by region", 
       caption="*Information based in speeches at the UN General Assembly and PTS of Amnesty International", 
       y="Human-Right Count",
       x="Year")+
  theme(axis.line = element_line(colour = 'black'),
        panel.grid.major = element_line(colour = 'gray'),
        panel.grid.minor = element_line(colour = 'gray'),
        panel.border = element_blank(),
        panel.background = element_blank(),
        plot.title = element_text(size = 16,hjust = 0.5),
        plot.subtitle = element_text(size = 12,hjust = 0.5),
        plot.margin = unit(c(0.5,0.5,0.5,0.5), "cm"),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        plot.caption = element_text(size = 8,hjust = 0,margin=margin(t=10)),
        legend.position="bottom",
        legend.title = element_text(size = 11),
        legend.justification = "center",
        legend.spacing = unit(5.0, 'cm'),
        legend.text=element_text(size=10))



#hhrr pts =4&5
merge_HRdict_counts31<-merge_HRdict_counts %>% 
                      subset(PTS_A>3) %>% 
                      group_by(Region,Year) %>%
                      summarise_at("HHRR",funs(mean(., na.rm=TRUE)))
merge_HRdict_counts31$Region<-factor(merge_HRdict_counts31$Region, labels=c("East Asia and Pacific","Europe and Central Asia", "Latin America and Caribbean", "Middle East and North Africa","North America","South Asia","Sub-Saharan Africa" ),levels=c("eap","eca","lac","mena","na","sa","ssa"))

g_merge_HRdict_counts31<-ggplot(merge_HRdict_counts31,aes(x=Year,y=HHRR,color=Region))+
geom_line()+
  scale_y_continuous(limits = c(0, 20), breaks=seq(0,20,5),expand = c(0, 0))+
  scale_x_continuous(limits = c(1976, 2018), breaks=seq(1976,2018,7),expand = c(0, 0))+
labs(title="Average count of words related to Human Rights in UN speeches", 
       subtitle="Countries with PTS score of 4 & 5 grouped by region", 
       caption="*Information based in speeches at the UN General Assembly and PTS of Amnesty International", 
       y="Human-Right Count",
       x="Year")+
  theme(axis.line = element_line(colour = 'black'),
        panel.grid.major = element_line(colour = 'gray'),
        panel.grid.minor = element_line(colour = 'gray'),
        panel.border = element_blank(),
        panel.background = element_blank(),
        plot.title = element_text(size = 16,hjust = 0.5),
        plot.subtitle = element_text(size = 12,hjust = 0.5),
        plot.margin = unit(c(0.5,0.5,0.5,0.5), "cm"),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        plot.caption = element_text(size = 8,hjust = 0,margin=margin(t=10)),
        legend.position="bottom",
        legend.title = element_text(size = 11),
        legend.justification = "center",
        legend.spacing = unit(5.0, 'cm'),
        legend.text=element_text(size=10))


#hr pts =1-3
merge_HRdict_counts4<-merge_HRdict_counts %>% 
                      subset(PTS_A<4) %>% 
                      group_by(Region,Year) %>%
                      summarise_at("HR",funs(mean(., na.rm=TRUE)))
merge_HRdict_counts4$Region<-factor(merge_HRdict_counts4$Region, labels=c("East Asia and Pacific","Europe and Central Asia", "Latin America and Caribbean", "Middle East and North Africa","North America","South Asia","Sub-Saharan Africa" ),levels=c("eap","eca","lac","mena","na","sa","ssa"))

g_merge_HRdict_counts4<-ggplot(merge_HRdict_counts4,aes(x=Year,y=HR,color=Region))+
  geom_line()+
  scale_y_continuous(limits = c(0, 140), breaks=seq(0,140,35),expand = c(0, 0))+
  scale_x_continuous(limits = c(1976, 2018), breaks=seq(1976,2018,7),expand = c(0, 0))+
labs(title="Average count of words related to Human Rights in UN speeches", 
       subtitle="Countries with PTS score of 1 to 3 grouped by region", 
       caption="*Information based in speeches at the UN General Assembly and PTS of of Amnesty International", 
       y="Dictionary Count",
       x="Year")+
  theme(axis.line = element_line(colour = 'black'),
        panel.grid.major = element_line(colour = 'gray'),
        panel.grid.minor = element_line(colour = 'gray'),
        panel.border = element_blank(),
        panel.background = element_blank(),
        plot.title = element_text(size = 16,hjust = 0.5),
        plot.subtitle = element_text(size = 12,hjust = 0.5),
        plot.margin = unit(c(0.5,0.5,0.5,0.5), "cm"),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        plot.caption = element_text(size = 8,hjust = 0,margin=margin(t=10)),
        legend.position="bottom",
        legend.title = element_text(size = 11),
        legend.justification = "center",
        legend.spacing = unit(5.0, 'cm'),
        legend.text=element_text(size=10))

#hr pts =4&5
merge_HRdict_counts41<-merge_HRdict_counts %>% 
                      subset(PTS_A>3) %>% 
                      group_by(Region,Year) %>%
                      summarise_at("HR",funs(mean(., na.rm=TRUE)))
merge_HRdict_counts41$Region<-factor(merge_HRdict_counts41$Region, labels=c("East Asia and Pacific","Europe and Central Asia", "Latin America and Caribbean", "Middle East and North Africa","North America","South Asia","Sub-Saharan Africa" ),levels=c("eap","eca","lac","mena","na","sa","ssa"))

g_merge_HRdict_counts41<-ggplot(merge_HRdict_counts41,aes(x=Year,y=HR,color=Region))+
  geom_line()+
  scale_y_continuous(limits = c(0, 140), breaks=seq(0,140,35),expand = c(0, 0))+
  scale_x_continuous(limits = c(1976, 2018), breaks=seq(1976,2018,7),expand = c(0, 0))+
labs(title="Average count of words related to Human Rights in UN speeches", 
       subtitle="Countries with PTS score of 4 & 5 grouped by region", 
       caption="*Information based in speeches at the UN General Assembly and PTS of Amnesty International", 
       y="Dictionary Count",
       x="Year")+
  theme(axis.line = element_line(colour = 'black'),
        panel.grid.major = element_line(colour = 'gray'),
        panel.grid.minor = element_line(colour = 'gray'),
        panel.border = element_blank(),
        panel.background = element_blank(),
        plot.title = element_text(size = 16,hjust = 0.5),
        plot.subtitle = element_text(size = 12,hjust = 0.5),
        plot.margin = unit(c(0.5,0.5,0.5,0.5), "cm"),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        plot.caption = element_text(size = 8,hjust = 0,margin=margin(t=10)),
        legend.position="bottom",
        legend.title = element_text(size = 11),
        legend.justification = "center",
        legend.spacing = unit(5.0, 'cm'),
        legend.text=element_text(size=10))


merge_HRdict_counts5<-merge_HRdict_counts %>% 
                      subset(PTS_S>3) %>% 
                      group_by(Year) %>%
                      summarise_at("HR",funs(mean(., na.rm=TRUE)))

merge_HRdict_counts51<-merge_HRdict_counts %>% 
                      subset(PTS_S<4) %>% 
                      group_by(Year) %>%
                      summarise_at("HR",funs(mean(., na.rm=TRUE)))


ggplot(NULL,aes(x=Year,y=HR))+
    geom_line(data=merge_HRdict_counts51, color="green")+
  geom_line(data=merge_HRdict_counts5)

summary(merge_HRdict_counts5)
summary(merge_HRdict_counts51)


```



```{r}
merge_HHRRcounts$PTS_S_dummy <- factor(merge_HHRRcounts$PTS_S)
is.factor(merge_HHRRcounts$PTS_S_dummy)

merge_HHRRcounts$PTS_A_dummy <- factor(merge_HHRRcounts$PTS_A)
is.factor(merge_HHRRcounts$PTS_A_dummy)

merge_HHRRcounts$PTS_H_dummy <- factor(merge_HHRRcounts$PTS_H)
is.factor(merge_HHRRcounts$PTS_H_dummy)

ModelHHRR_S <- lm (HHRR ~ PTS_S_dummy + factor(PTS_S_var) + PTS_S_dummy*factor(PTS_S_var), data = merge_HHRRcounts)
screenreg(ModelHHRR_S)
#PTS_S significant and negative

ModelHHRR_A <- lm (HHRR ~ factor(PTS_A) + PTS_A_var + factor(PTS_A)*PTS_A_var, data = merge_HHRRcounts)
screenreg(ModelHHRR_A)

ModelHHRR_A <- lm (HHRR ~ factor(PTS_A) + factor(PTS_A_var) + factor(PTS_A)*factor(PTS_A_var), data = merge_HHRRcounts)

names(merge_HHRRcounts)
#PTS_A significant and negative

ModelHHRR_H <- lm (HHRR ~ PTS_H_dummy + factor(PTS_H_var) + PTS_H_dummy*factor(PTS_H_var), data = merge_HHRRcounts)
screenreg(ModelHHRR_H)
summary(ModelHHRR_S)
#PTS_H insignificant



```


```{r}
#regression with fixed effects
install.packages("plm")
library(plm)
str(merge_HHRRcounts)

ModelHHRR_S_fe <- plm (HHRR ~ PTS_S_dummy + factor(PTS_S_var) + PTS_S_dummy*factor(PTS_S_var), data = merge_HHRRcounts, index = c("MergeCountry", "Year"), effect = "twoways", model = "within")
screenreg(ModelHHRR_S_fe)
summary(ModelHHRR_S_fe)

#resulting duplicate couples
table(index(merge_HHRRcounts), useNA = "ifany")

#PTS_S significant and negative
ModelHHRR_A_fe <- plm (HHRR ~ PTS_A_dummy + factor(PTS_A_var) + PTS_A_dummy*factor(PTS_A_var), data = merge_HHRRcounts, effect = "twoways", model = "within")
screenreg(ModelHHRR_A_fe)

#PTS_A significant and negative
ModelHHRR_H_fe <- plm (HHRR ~ PTS_H_dummy + factor(PTS_H_var) + PTS_H_dummy*factor(PTS_H_var), data = merge_HHRRcounts, effect = "twoways", model = "within")
screenreg(ModelHHRR_H_fe)
```



```{r}

ModelHHRR_A <- lm (HHRR ~ factor(PTS_A) + factor(PTS_A_var) + factor(PTS_A)*factor(PTS_A_var), data = merge_HHRRcounts)

ModelHRdict_A <- lm (HR ~ factor(PTS_A) + factor(PTS_A_var) + factor(PTS_A)*factor(PTS_A_var), data = merge_HRdict_counts)
screenreg(ModelHRdict_A_feHHRR)
names(ModelHRdict_A_fe)


ModelHRdict_A_feHR <- plm (HR ~ factor(PTS_A) + PTS_A_var + factor(PTS_A)*PTS_A_var, data = merge_HRdict_counts, effect = "twoway", model = "within")

ModelHRdict_A_feHHRR <- plm (HHRR ~ factor(PTS_A) + PTS_A_var + factor(PTS_A)*PTS_A_var, data = merge_HRdict_counts, effect = "twoway", model = "within")

```


```{r}

ModelHR_A <- lm (HR ~ factor(PTS_A) + PTS_A_var + factor(PTS_A)*PTS_A_var, data = merge_HRdict_counts)

stargazer(ModelHR_A, ModelHRdict_A_feHR, ModelHHRR_A, ModelHRdict_A_feHHRR,
          align=TRUE,
          type = 'latex',
          column.sep.width = "3 pt",
          omit.stat=c("LL","ser","f","adj.rsq"),
          title= "OLS and two-way fixed effects models-Effect PTS AI on HR mentions",
          covariate.labels = c("PTS=2", "PTS=3","PTS=4","PTS=5","VPTS","PTS=2*VPTS", "PTS=3*VPTS","PTS=4*VPTS","", "Constant"))
          
          
library(stargazer)
stargazer(ModelHHRR_S, ModelHHRR_A, ModelHHRR_H,
          align=TRUE,
          type = 'text',
          covariate.labels = c("a","s","d","f","g","h","j","k"),
          column.sep.width = "10pt",
          title= "Table 1. OLS regression - Effect of Barcenas scandal on trust in police",
          dep.var.labels = "Trust in Police")
          model.names = FALSE, 
          column.labels = c("Amnesty International", "State Department","Human Rights Watch"),
          model.numbers = FALSE,
          omit.stat=c("LL","ser","f","adj.rsq"	),
          star.char = c("*","**","***"),
          star.cutoffs = c(0.05,0.01,0.001),
          covariate.labels = c("D (Exposure to the Bárcenas scandal)", "Constant"))
```

